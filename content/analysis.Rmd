---
title: Analysis
description:
toc: true
featuredVideo:
featuredImage: https://upload.wikimedia.org/wikipedia/commons/7/77/Pebbleswithquarzite.jpg
draft: false
---

We describe here our detailed data analysis.

```{r}
library(tidyverse)
print(getwd())
data <- read_csv(here::here("dataset/school_scores_data_clean.csv"))
load(here::here("dataset/school_scores.RData"))
print(ls())
```

-------
The variables we are most interested in are total math and verbal SAT scores as well as family income â€” namely, we want to examine whether or not there exists a statistically significant relationship between family income and SAT scores, and the form of these relationships (i.e., linear, logistic, etc.). Over the past several years, more and more questions have arose regarding whether or not colleges (and the rest of the world) should be looking at SAT scores as a credible measure of aptitude and intelligence, or if they are simply another tool for the privileged to remain at the top. 

Some questions we would like to answer are:

1. What is the nature of the relationship between family income and SAT scores?
2. Is this relationship statistically significant?
3. Are there differences in income and SAT scores between states? 
4. Is performance in certain subjects more sensitive to changes in family income than others (e.g., math vs. English)?
5. Is GPA more affected by family income than SAT scores?

>  

* Modeling and Inference 
  * You should also include some kind of formal statistical model and/or inference. This could be a linear regression, logistic regression, hypothesis testing etc.

```{r new data}
library(stringr)
schooldata <- read_csv(here::here("dataset/school_scores_data_clean.csv"))
schooldatacleaned <- read_csv(here::here("dataset/schooldatacleaned.csv"))
schooldatacleaned_math <- schooldatacleaned %>% 
  select(year,"state.code","income.less.than.20k.math", "income.between.20.40k.math", "income.between.60.80k.math", "income.between.80.100k.math", "income.more.than.100k.math") %>%
  pivot_longer(c(income.less.than.20k.math, income.between.20.40k.math, income.between.60.80k.math, income.between.80.100k.math, income.more.than.100k.math), 
               names_to = "income.bracket.math", 
               values_to = "average.math.score.of.bracket", 
               values_drop_na = TRUE) %>%
  mutate(income.bracket = income.bracket.math)
  mutate_at("income.bracket", str_replace, "income.less.than.20k.math", "income.less.than.20k") %>%
  select("state.code", "income.bracket","average.math.score.of.bracket") 
schooldatacleaned_math

schooldatacleaned_verbal <- schooldatacleaned %>% 
  select(year,"state.code","income.less.than.20k.verbal", "income.between.20.40k.verbal", "income.between.60.80k.verbal", "income.between.80.100k.verbal", "income.more.than.100k.verbal") %>%
  pivot_longer(c(income.less.than.20k.verbal, income.between.20.40k.verbal, income.between.60.80k.verbal, income.between.80.100k.verbal, income.more.than.100k.verbal), 
               names_to = "income.bracket.verbal", 
               values_to = "average.verbal.score.of.bracket", 
               values_drop_na = TRUE) %>%
  select("state.code", "income.bracket.verbal", "average.verbal.score.of.bracket")
schooldatacleaned_verbal

schooldatacleaned <- schooldatacleaned_math %>%
  left_join(schooldatacleaned_verbal, by = c("income.bracket.math" = "income.bracket.verbal", 
                                             "state.code" = "state.code"))
schooldatacleaned
```

```{r model 1}
sixstates <- c("MD", "NJ", "MA", "AR", "WV", "MS")
schooldata6 <- schooldata %>% 
  filter(State.Code %in% sixstates) %>% 
  mutate(Total.Score = Total.Math + Total.Verbal) %>% 
  select("State.Code", "Total.Score") %>% 
  group_by(State.Code) %>% 
  transmute(avg.total.score = mean(Total.Score))
schooldata6

ggplot(data = schooldata6, mapping = aes(x = State.Code, y = avg.total.score, fill = State.Code)) + geom_col(aes(color = State.Code))
```

```{r model 2}
schooldatacleaned <- schooldatacleaned %>% 
  mutate(average.total.score.of.bracket = average.math.score.of.bracket + average.verbal.score.of.bracket) %>% 
  select("state.code", "income.bracket", "average.total.score.of.bracket") %>% 
  group_by(income.bracket) 
schooldatacleaned

ggplot(data = schooldatacleaned, mapping = aes(x = income.bracket, y = average.total.score.of.bracket, fill = income.bracket)) + geom_col(aes(color = income.bracket)) + labs(x = "Income Bracket", y = "Average SAT Score of Bracket") 
#ggplot(schooldatacleaned, fill = income.bracket.math) + geom_col(aes(x = income.bracket.math, y = average.total.score.of.bracket, color = income.bracket.math))
```

```{r model 3}
# boxplot of all states and their average total scores
schooldata3 <- schooldata %>% mutate(Total.Score = Total.Math + Total.Verbal) %>% select("State.Code", "Total.Score") %>% group_by(State.Code)

ggplot(schooldata3, aes(x = Total.Score, y = State.Code)) + geom_boxplot() + labs(x = "SAT Score", y = "State")
```

```{r model 4}
# map of average total score by state
library(maps)

schooldata4 <- schooldata %>% mutate(Total.Score = Total.Math + Total.Verbal) %>% select("State.Name", "Total.Score") %>% group_by(State.Name) %>% transmute(avg.total.score = mean(Total.Score), State.Name)
schooldata4 <- unique(schooldata4)

MainStates <- map_data("state")
states <- MainStates %>% transmute(region) %>% unique()
schooldata4 <- schooldata4 %>% transmute(region = str_to_lower(State.Name), avg.total.score) %>% 
  filter(region %in% states$region)

MergedStates <- inner_join(MainStates, schooldata4, by = "region")

ggplot() + geom_polygon(data = MergedStates, aes(x = long, y = lat, group = group, 
                                                 fill = avg.total.score), color = "white") +
  scale_fill_continuous(name = "Avg. SAT Score") + 
  labs(title = "Average SAT Score by State")
                          
```

```{r model 5}
west <- c("WA","OR", "ID", "MT", "WY", "CA", "NV", "UT", "CO")
southwest <- c("AZ", "NM", "OK", "TX")
midwest <- c("ND", "SD", "NE", "KS", "MN", "IA", "MO", "WI", "IL", "MI", "IN", "OH")
southeast <- c("LA", "MS", "TN", "KY", "WV", "VA", "NC", "SC", "AL", "GA", "FL", "AR")
northeast <- c("MA", "MD", "DE", "NJ", "ME", "VT", "NH", "PA", "NY", "CT", "RI")
continental_us <- c(west, southwest, midwest, southeast, northeast)
state_codes <- schooldata %>% select(State.Code) %>% unique() %>% filter(State.Code %in% continental_us)

schooldata5 <- schooldata %>% mutate(Total.Score = Total.Math + Total.Verbal) %>% select("State.Code", "Total.Score", "Year") %>% add_column(region = NA) %>% mutate(region = ifelse(State.Code %in% west, "west", region)) %>% mutate(region = ifelse(State.Code %in% southwest, "southwest", region)) %>% mutate(region = ifelse(State.Code %in% midwest, "midwest", region)) %>% mutate(region = ifelse(State.Code %in% southeast, "southeast", region)) %>% mutate(region = ifelse(State.Code %in% northeast, "northeast", region)) %>% group_by(region)


continental_us <- schooldata$State.Code %>% unique()
#continental_us
par(mfrow = c(2,3))

schooldata5 %>% filter(region == "west") %>%
  ggplot(aes(x = State.Code , y = Total.Score)) + geom_point()

schooldata5 %>% filter(region == "southwest") %>%
  ggplot(aes(x = State.Code , y = Total.Score)) + geom_point()

schooldata5 %>% filter(region == "midwest") %>%
  ggplot(aes(x = State.Code , y = Total.Score)) + geom_point()

schooldata5 %>% filter(region == "southeast") %>%
  ggplot(aes(x = State.Code , y = Total.Score)) + geom_point()

schooldata5 %>% filter(region == "northeast") %>%
  ggplot(aes(x = State.Code , y = Total.Score)) + geom_point()
```


```
